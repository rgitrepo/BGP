## AS_PATH



| **Original Text**                                                                                                                                         | **Explanation with Enhanced Clarification and Examples**                                                                                                                                                                                                                                                                                                                                                                                                              |
|------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Path Attributes** <br> This section discusses the path attributes of the UPDATE message. Path attributes fall into four separate categories: <br> 1. Well-known mandatory. <br> 2. Well-known discretionary. <br> 3. Optional transitive. <br> 4. Optional non-transitive. | **Path Attributes Categories**: <br> Path attributes in BGP are additional data attached to UPDATE messages that describe the properties of a route. These attributes fall into four categories: <br> **1. Well-known mandatory**: Must always be included in UPDATE messages with NLRI. Example: `ORIGIN`, `AS_PATH`, `NEXT_HOP`. <br> **2. Well-known discretionary**: May or may not be included in UPDATE messages. Example: `MULTI_EXIT_DISC`, `LOCAL_PREF`. <br> **3. Optional transitive**: Not required to be recognized by all BGP implementations but passed to other peers if unrecognized. Example: If a router encounters an unrecognized transitive attribute, it forwards it with the `Partial` bit set. <br> **4. Optional non-transitive**: Ignored if unrecognized and not forwarded to other peers. Example: Experimental or implementation-specific attributes. |
| **BGP implementations MUST recognize all well-known attributes. Some of these attributes are mandatory and MUST be included in every UPDATE message that contains NLRI. Others are discretionary and MAY or MAY NOT be sent in a particular UPDATE message.** | **Well-known Attributes**: <br> - **Mandatory Attributes**: These are essential for all UPDATE messages containing NLRI (e.g., `ORIGIN`, `AS_PATH`, `NEXT_HOP`). These ensure fundamental route information is shared. <br> - **Discretionary Attributes**: These are optional even in NLRI-containing messages (e.g., `MULTI_EXIT_DISC`, `ATOMIC_AGGREGATE`). Discretionary attributes add flexibility for specific routing scenarios without being required universally. <br> **Example**: A router announcing a route to its internal network will always include `NEXT_HOP` (mandatory) but may omit `MULTI_EXIT_DISC` (discretionary). |
| **Once a BGP peer has updated any well-known attributes, it MUST pass these attributes to its peers in any updates it transmits.**                          | **Propagation of Well-known Attributes**: <br> Any router that modifies a well-known attribute must propagate the updated version to its peers. This ensures consistency across the BGP network. <br> **Example**: If Router A modifies the `AS_PATH` for a route, it must include the updated `AS_PATH` when advertising the route to its peers (e.g., Router B and Router C). |
| **In addition to well-known attributes, each path MAY contain one or more optional attributes.**                                                           | **Optional Attributes**: These can enhance route details or support specific network requirements. Unlike well-known attributes, optional attributes are not universally recognized or required. <br> **Example**: A custom attribute for local traffic engineering might be added to a route by a specific router but is not expected to be understood by all BGP peers. |
| **The handling of an unrecognized optional attribute is determined by the setting of the Transitive bit in the attribute flags octet.**                    | **Handling Unrecognized Optional Attributes**: <br> The `Transitive bit` determines how an optional attribute is treated if unrecognized: <br> - **Transitive Attributes**: Accepted and forwarded to other peers. Example: An unrecognized `Partial` transitive attribute is propagated to ensure compatibility. <br> - **Non-Transitive Attributes**: Ignored and not forwarded. Example: A proprietary attribute for local use would be silently dropped by peers. |
| **Paths with unrecognized transitive optional attributes SHOULD be accepted.**                                                                             | **Acceptance of Transitive Attributes**: <br> Even if a router doesn’t recognize a transitive attribute, it should accept the route and forward the attribute. This ensures route propagation isn’t disrupted due to unknown attributes. <br> **Example**: A router receives a route with an experimental transitive attribute. It doesn’t understand the attribute but forwards it to other peers unchanged. |
| **If a path with an unrecognized transitive optional attribute is accepted and passed to other BGP peers, then the unrecognized transitive optional attribute of that path MUST be passed, along with the path, to other BGP peers with the Partial bit in the Attribute Flags octet set to 1.** | **Propagation of Partial Transitive Attributes**: <br> When a router forwards a path with an unrecognized transitive attribute, it sets the `Partial` bit to indicate that not all routers along the path recognized this attribute. <br> **Example**: Router A adds an unrecognized transitive attribute to a route. Router B forwards it to Router C with the `Partial` bit set to 1. Router C recognizes that this attribute might have been altered or unrecognized by earlier routers. |
| **Unrecognized non-transitive optional attributes MUST be quietly ignored and not passed along to other BGP peers.**                                       | **Non-Transitive Attributes**: If a router encounters an unrecognized non-transitive attribute, it ignores it completely and doesn’t forward it. <br> **Example**: A router receives a route with a custom, non-transitive attribute for internal use. The router drops the attribute without affecting the route propagation. |
| **The sender of an UPDATE message SHOULD order path attributes within the UPDATE message in ascending order of attribute type.**                            | **Order of Path Attributes**: Path attributes should be ordered by their type for consistency and easier processing. <br> **Example**: If a route has `AS_PATH (Type 2)`, `ORIGIN (Type 1)`, and `NEXT_HOP (Type 3)`, the attributes should be sent in the order `ORIGIN`, `AS_PATH`, `NEXT_HOP`. |
| **The same attribute (attribute with the same type) cannot appear more than once within the Path Attributes field of a particular UPDATE message.**         | **Uniqueness of Attributes**: Each attribute type can only appear once in an UPDATE message. Duplicates are not allowed. <br> **Example**: A route cannot have two `NEXT_HOP` attributes. If such a message is received, it’s considered invalid. |
| **The mandatory category refers to an attribute that MUST be present in both IBGP and EBGP exchanges if NLRI are contained in the UPDATE message.**         | **Mandatory Attributes**: These attributes must always be present when routes (NLRI) are exchanged in both internal BGP (IBGP) and external BGP (EBGP). <br> **Example**: Routes shared between two ISPs must always include `ORIGIN`, `AS_PATH`, and `NEXT_HOP`. |
| **Attributes classified as optional for the purpose of the protocol extension mechanism may be purely discretionary, discretionary, required, or disallowed in certain contexts.** | **Optional Attribute Categories**: Optional attributes have varied requirements: <br> - **Discretionary**: May or may not be included (e.g., `MULTI_EXIT_DISC`). <br> - **Required**: Must be included in specific scenarios (e.g., `LOCAL_PREF` for IBGP). <br> - **Disallowed**: Not permitted in some contexts (e.g., using `MULTI_EXIT_DISC` in IBGP is discouraged). |
| **Attribute Table** <br> attribute | EBGP | IBGP <br> ORIGIN | mandatory | mandatory <br> AS_PATH | mandatory | mandatory <br> NEXT_HOP | mandatory | mandatory <br> MULTI_EXIT_DISC | discretionary | discretionary <br> LOCAL_PREF | discretionary | required | **Attribute Table Explained**: <br> This table summarizes the requirements for key attributes in different BGP scenarios: <br> - **ORIGIN, AS_PATH, NEXT_HOP**: Always mandatory in both EBGP and IBGP. <br> - **MULTI_EXIT_DISC**: Used for external routes (EBGP) to influence path selection; discretionary in both EBGP and IBGP. <br> - **LOCAL_PREF**: Used internally (IBGP) to determine preferred routes; required in IBGP but discretionary in EBGP. |



---

Here’s a **detailed explanation and examples** of the **AS_PATH attribute** for all four cases:

---

### **1. Case: Well-Known Mandatory (AS_PATH in Normal BGP Operation)**

| **Explanation**                                                                                                                                                                                                                  | **Example**                                                                                                                                                                                                                                                                                                                                                          |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| - `AS_PATH` is a **well-known mandatory attribute**, meaning it must be included in every BGP UPDATE message. <br> - It records the Autonomous Systems (ASes) that a route traverses. <br> - Used for **loop detection** and **path preference**. | **Example**: AS1 advertises a route to AS2. <br> - When AS2 advertises the route to AS3, it appends its own AS number to the `AS_PATH`. <br> - If AS_PATH = `{AS1}` in AS2, then AS_PATH = `{AS2, AS1}` in AS3. <br> **Purpose**: AS3 can determine the origin of the route and its path through AS1 and AS2, and avoid loops by checking for its own AS in the path. |

---

### **2. Case: Well-Known Discretionary (AS_PATH with Aggregation)**

| **Explanation**                                                                                                                                                                                                                  | **Example**                                                                                                                                                                                                                                                                                                                                                          |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| - In aggregation, an `AS_SET` (unordered list of ASes) may replace the ordered `AS_PATH`. <br> - This is **discretionary** because the route aggregator can decide whether to include or drop the `AS_SET`. <br> - Ensures that route information is preserved while avoiding loops. | **Example**: AS1 aggregates routes from AS2 and AS3 to advertise a single route. <br> - The aggregated route includes an `AS_SET = {AS2, AS3}` instead of the ordered `AS_PATH`. <br> - If AS_PATH before aggregation was `{AS2, AS3}`, it is replaced with `AS_SET = {AS2, AS3}` during aggregation. <br> **Purpose**: Indicates that the route originated from AS2 and AS3 but avoids listing an explicit path. |

---

### **3. Case: Optional Transitive (AS_PATH in Confederations)**

| **Explanation**                                                                                                                                                                                                                  | **Example**                                                                                                                                                                                                                                                                                                                                                          |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| - In **BGP Confederations**, `AS_PATH` is modified to reflect sub-ASes within the confederation. <br> - It is **optional transitive**, meaning the `AS_PATH` is altered but remains consistent across external AS boundaries.                                               | **Example**: AS1 consists of two sub-ASes, AS65001 and AS65002, forming a BGP Confederation. <br> - When a route is advertised between sub-ASes (AS65001 to AS65002), the `AS_PATH` is modified to include only the confederation identifier (AS1). <br> - When advertising the route to an external AS (e.g., AS2), the `AS_PATH = {AS1}` hides internal sub-AS details. |

---

### **4. Case: Optional Non-Transitive (AS_PATH Filtering)**

| **Explanation**                                                                                                                                                                                                                  | **Example**                                                                                                                                                                                                                                                                                                                                                          |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| - An **optional non-transitive** case occurs when `AS_PATH` filtering is applied based on policy. <br> - The filtered or modified `AS_PATH` is not propagated beyond the AS that applied the filter.                                                                   | **Example**: Router A in AS1 filters routes from AS2 based on specific policies. <br> - Routes from AS2 with `AS_PATH = {AS3, AS2}` are modified to exclude AS2 (if AS2 is irrelevant for AS1). <br> - The modified `AS_PATH = {AS3}` is used internally in AS1 but not propagated to AS3 or other external peers. |

---

### Summary Table

| **Case**                    | **Key Feature**                                                    | **Example**                                                                                                                                                                                                                                                                                                                                                          |
|-----------------------------|--------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **Well-Known Mandatory**    | Always included in every UPDATE message.                          | AS1 → AS2 → AS3: `AS_PATH = {AS2, AS1}` ensures loop detection and path origin.                                                                                                                                                                                                                                                                                      |
| **Well-Known Discretionary**| Can replace `AS_PATH` with `AS_SET` during aggregation.            | AS1 aggregates AS2 and AS3 routes: `AS_SET = {AS2, AS3}` instead of ordered AS_PATH.                                                                                                                                                                                                                                                                                 |
| **Optional Transitive**      | Modified for confederations and propagates across AS boundaries.  | AS1 (Confederation) → AS2: `AS_PATH = {AS1}` hides sub-ASes (e.g., AS65001 and AS65002).                                                                                                                                                                                                                                                                              |
| **Optional Non-Transitive**  | Modified by policy and not propagated beyond the filtering AS.    | AS1 filters AS2 routes: Internal `AS_PATH = {AS3}` excludes AS2 and is not advertised outside AS1.                                                                                                                                                                                                                                                                   |



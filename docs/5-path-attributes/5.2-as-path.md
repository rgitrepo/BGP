## AS_PATH


---

| **Original Text**                                                                                                                                         | **Explanation with Enhanced Clarification and Examples**                                                                                                                                                                                                                                                                                                                                                                                                              |
|------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **AS_PATH** <br> AS_PATH is a well-known mandatory attribute. This attribute identifies the autonomous systems through which routing information carried in this UPDATE message has passed. The components of this list can be AS_SETs or AS_SEQUENCEs. | **AS_PATH Overview**: <br><br> - `AS_PATH` is a **well-known mandatory attribute**, meaning it must be included in all UPDATE messages. <br><br> - It records the **sequence of Autonomous Systems (ASes)** that routing information has traversed. <br><br> - `AS_PATH` components can be of two types: <br> **1. AS_SEQUENCE**: An ordered list of AS numbers showing the path. <br> **2. AS_SET**: An unordered set of AS numbers used in route aggregation. <br><br> **Example**: A route traversing AS1 → AS2 → AS3 will have `AS_PATH = {AS3, AS2, AS1}` in reverse order to reflect the traversed path. |
| **When a BGP speaker propagates a route it learned from another BGP speaker's UPDATE message, it modifies the route's AS_PATH attribute based on the location of the BGP speaker to which the route will be sent:** | **Modifying AS_PATH During Route Propagation**: <br><br> The `AS_PATH` attribute is adjusted depending on whether the route is sent to an internal or external peer. This ensures proper routing behavior and prevents loops.                                                                                                                                                                                                                                                                   |
| **a) When a given BGP speaker advertises the route to an internal peer, the advertising speaker SHALL NOT modify the AS_PATH attribute associated with the route.** | **Internal Peer Advertisement**: <br><br> - When advertising routes to **internal peers** (within the same AS), the `AS_PATH` remains unchanged. <br><br> **Example**: Router A in AS1 advertises a route to Router B (internal). If the `AS_PATH` was `{AS3, AS2}`, it is sent as-is to Router B without modification. |
| **b) When a given BGP speaker advertises the route to an external peer, the advertising speaker updates the AS_PATH attribute as follows:** | **External Peer Advertisement**: <br><br> - When advertising routes to **external peers** (outside the AS), the router modifies the `AS_PATH` to include its own AS number, ensuring accurate path information.                                                                                                                                                                                                                                                |
| **1) if the first path segment of the AS_PATH is of type AS_SEQUENCE, the local system prepends its own AS number as the last element of the sequence (put it in the leftmost position with respect to the position of octets in the protocol message).** | **Prepending to AS_SEQUENCE**: <br><br> - If the first segment of `AS_PATH` is an ordered list (`AS_SEQUENCE`), the router adds its AS number to the **beginning** of the sequence. <br><br> **Example**: A route received with `AS_PATH = {AS3, AS2}` at AS1 is advertised as `AS_PATH = {AS1, AS3, AS2}` to an external peer. <br><br> - **Overflow Handling**: If the sequence exceeds 255 entries, the router creates a new `AS_SEQUENCE` segment and prepends its AS to it. |
| **2) if the first path segment of the AS_PATH is of type AS_SET, the local system prepends a new path segment of type AS_SEQUENCE to the AS_PATH, including its own AS number in that segment.** | **Prepending to AS_SET**: <br><br> - If the first segment of `AS_PATH` is an unordered set (`AS_SET`), the router creates a new ordered sequence (`AS_SEQUENCE`) and adds its AS number to it. <br><br> **Example**: A route received with `AS_PATH = {AS_SET = {AS2, AS3}}` at AS1 is advertised as `AS_PATH = {AS_SEQUENCE = {AS1}, AS_SET = {AS2, AS3}}`. |
| **3) if the AS_PATH is empty, the local system creates a path segment of type AS_SEQUENCE, places its own AS into that segment, and places that segment into the AS_PATH.** | **Adding AS_PATH for Empty Routes**: <br><br> - If `AS_PATH` is empty, the router creates an ordered sequence (`AS_SEQUENCE`) containing only its AS number. <br><br> **Example**: AS1 originates a new route without an existing `AS_PATH`. It advertises the route as `AS_PATH = {AS_SEQUENCE = {AS1}}`. |
| **When a BGP speaker originates a route then:**                                                                                                            | **Route Origination**: <br><br> When a router originates a route, it sets the `AS_PATH` differently for internal and external peers.                                                                                                                                                                                                                                                                                                                      |
| **a) the originating speaker includes its own AS number in a path segment, of type AS_SEQUENCE, in the AS_PATH attribute of all UPDATE messages sent to an external peer.** | **External Peer Route Origination**: <br><br> - When sending a route to an **external peer**, the originating router creates a `AS_SEQUENCE` containing its own AS number. <br><br> **Example**: Router A in AS1 originates a route and advertises it to AS2. The `AS_PATH` in the advertisement is `AS_PATH = {AS_SEQUENCE = {AS1}}`. |
| **b) the originating speaker includes an empty AS_PATH attribute in all UPDATE messages sent to internal peers.**                                           | **Internal Peer Route Origination**: <br><br> - When advertising routes to **internal peers**, the `AS_PATH` is left empty. <br><br> **Example**: Router A in AS1 originates a route and advertises it to Router B (internal). The `AS_PATH` is `AS_PATH = {}` (empty). |
| **Whenever the modification of the AS_PATH attribute calls for including or prepending the AS number of the local system, the local system MAY include/prepend more than one instance of its own AS number in the AS_PATH attribute. This is controlled via local configuration.** | **Prepending Multiple AS Numbers**: <br><br> - A router can be configured to add multiple instances of its own AS number to `AS_PATH`, often to influence path selection. <br><br> **Example**: Router A in AS1 advertises a route to AS2 with `AS_PATH = {AS1, AS1, AS1}`. This multiple prepending makes the route less preferred by AS2 to influence traffic flow. |

---


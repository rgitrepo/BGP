

### **What is NEXT_HOP?**
1. **Definition**: The `NEXT_HOP` attribute in BGP (Border Gateway Protocol) tells the router which IP address should be used as the next stop to forward packets to the destination.

2. **Purpose**: It ensures that routers know the next step in the journey of a packet through the network.

3. **Key Rule**: This is a **mandatory attribute** that must always be set.

---

### **How is NEXT_HOP Determined?**
BGP determines the `NEXT_HOP` value differently depending on the type of connection (internal vs. external peers) and how far the destination is.


---

### **Table 1: Internal Peer (Within the Same Network)**

| **No.** | **Original Text**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | **Explanation with Enhanced Clarification and Examples**                                                                                                                                                                                                                                                                                                                                                     |
|---------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **1**   | When sending a message to an internal peer, if the route is not locally originated, the BGP speaker SHOULD NOT modify the NEXT_HOP attribute unless it has been explicitly configured to announce its own IP address as the NEXT_HOP.                                                                                                                                                                                                                                                               | **1. Internal Peer (Within the Same Network)** <br> **Scenario**: When a router sends a route update to another router within the same organization or network. <br><br> **Rule**: When announcing a route to an internal peer, how the `NEXT_HOP` is handled depends on whether the route is **locally originated**. Locally originated routes are generated by the announcing router itself. For non-locally originated routes, the `NEXT_HOP` set by the original router should generally be preserved. |
| **1.1** | If the route is not locally originated, the BGP speaker SHOULD NOT modify the NEXT_HOP attribute unless it has been explicitly configured to announce its own IP address as the NEXT_HOP.                                                                                                                                                                                                                                                                                                               | **1.1. If the route is not locally originated:** <br> **Definition of Locally Originated**: A route is **locally originated** if it is directly created by the router itself (e.g., static routes or connected networks). Routes learned from another router are **not locally originated** for the receiving router. <br><br> **Rule**: Do **not** change the `NEXT_HOP` unless explicitly configured. Preserve the `NEXT_HOP` attribute set by the original announcing router. <br><br> **Practical Examples**: <br> **Example 1**: Router A learns about a route `192.168.1.0/24` from Router B (internal) with `NEXT_HOP = 172.16.0.1`. Router B is the originating router for this route (not Router A). Router A advertises this route to Router C (internal). Since this route is **not locally originated** for Router A, the `NEXT_HOP` remains `172.16.0.1` unless Router A is explicitly configured to override it. <br><br> **Example 2**: Router A is configured to keep the `NEXT_HOP` of incoming routes unchanged. Router B advertises the route `10.0.0.0/8` to Router A with `NEXT_HOP = 172.20.0.1`. Router A passes this route to Router C without modifying the `NEXT_HOP`. For Router A, this route is **not locally originated**, and it maintains `NEXT_HOP = 172.20.0.1`. Router C knows it must send packets to `172.20.0.1` to reach `10.0.0.0/8`. |
| **1.2** | When announcing a locally-originated route to an internal peer, the BGP speaker SHOULD use the interface address of the router through which the announced network is reachable for the speaker as the NEXT_HOP.                                                                                                                                                                                                                                                                                       | **1.2. If the route is locally originated:** <br> **Definition of Locally Originated**: Locally originated routes are created by the router itself (e.g., static routes, directly connected subnets, or redistributed routes). <br><br> **Rule**: Use the router's **own interface address** as the `NEXT_HOP`. This ensures that other routers know to forward traffic for the route through the announcing router. <br><br> **Practical Examples**: <br> **Example 1**: Router A originates a static route for `192.168.2.0/24` and advertises it to Router B. Router A sets its own interface address (`172.16.0.1`) as the `NEXT_HOP`. Router B knows to use Router A to forward traffic to this destination. <br><br> **Example 2**: If Router A is directly connected to the network `10.0.1.0/24` and announces it to Router B, Router A’s interface IP (`192.168.0.1`) is set as the `NEXT_HOP`. Router B knows to forward all packets for `10.0.1.0/24` to Router A. |
| **1.3** | If the route is directly connected to the speaker, or if the interface address of the router through which the announced network is reachable for the speaker is the internal peer's address, then the BGP speaker SHOULD use its own IP address for the NEXT_HOP attribute (the address of the interface that is used to reach the peer).                                                                                                                                                                 | **1.3. If the route is directly connected or if the peer’s address is used to reach the network:** <br> **Rule**: The router sets its **own IP** as the `NEXT_HOP`. <br><br> **Practical Examples**: <br> **Example 1**: Router A is directly connected to the network `172.16.2.0/24`. It advertises this route to Router B (internal) with `NEXT_HOP = 172.16.2.1` (Router A’s IP). <br><br> **Example 2**: Router A connects directly to `192.168.3.0/24` and advertises the route to Router C. Router A’s interface IP `192.168.3.1` is used as the `NEXT_HOP`. <br><br> **Example 3**: Router A connects to an internal subnet used for application servers (`10.20.30.0/24`). When advertising this route to Router B, Router A uses `NEXT_HOP = 10.20.30.1`. |

---

### **Table 2: External Peer (One Hop Away)**

---

| **No.** | **Original Text**                                                                                                                                                                                                                                                                                                                                                                                               | **Explanation with Enhanced Clarification and Examples**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
|---------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **2**   | **When sending a message to an external peer, X, and the peer is one IP hop away from the speaker:**                                                                                                                                                                                                                                                                                                            | **2. External Peer (One Hop Away):** <br><br> **Scenario**: When a router sends a route update to a directly connected external peer. <br><br> **Rule**: Determine `NEXT_HOP` based on where the route was learned and the relationship with the external peer.                                                                                                                                                                                                                                                                                                                                                     |
| **2.1** | **If the route being announced was learned from an internal peer or is locally originated, the BGP speaker can use an interface address of the internal peer router (or the internal router) through which the announced network is reachable for the speaker for the NEXT_HOP attribute, provided that peer X shares a common subnet with this address. This is a form of "third party" NEXT_HOP attribute.**                                           | **2.1. Learned from an internal peer or locally originated:** <br><br> **Rule**: Use the IP of the internal peer/router, provided the external peer shares a subnet with this address. This is called a "third-party" NEXT_HOP because the announcing router forwards the `NEXT_HOP` of the original internal peer to the external peer. <br><br> **Examples:** <br> **Example 1**: Router A (internal) learns route `192.168.1.0/24` from Router B (internal) with `NEXT_HOP = 10.1.1.1`. Router A advertises this to external Router C. Since Router C shares the same subnet as Router B, the `NEXT_HOP` remains `10.1.1.1`. <br><br> **Example 2**: Router A originates route `172.16.0.0/16` and advertises it to Router B (internal) with `NEXT_HOP = 192.168.2.1`. Router B advertises this route to external Router C, keeping the same `NEXT_HOP = 192.168.2.1` as long as Router C shares a subnet with Router A. |
| **2.2** | **Otherwise, if the route being announced was learned from an external peer, the speaker can use an IP address of any adjacent router (known from the received NEXT_HOP attribute) that the speaker itself uses for local route calculation in the NEXT_HOP attribute, provided that peer X shares a common subnet with this address. This is a second form of "third party" NEXT_HOP attribute.**                                                        | **2.2. Learned from an external peer:** <br><br> **Rule**: If the route was learned from an external peer, use the IP address of any adjacent router as the `NEXT_HOP`, provided the external peer (peer X) shares a subnet with this address. This is another "third-party" NEXT_HOP scenario. <br><br> **Examples:** <br> **Example 1**: Router A learns a route from external Router B with `NEXT_HOP = 172.20.0.1`. When Router A advertises this route to another external Router C, it retains `NEXT_HOP = 172.20.0.1` if Router C shares the same subnet as Router B. <br><br> **Example 2**: Router A receives route `10.0.0.0/8` from external Router B (peer) with `NEXT_HOP = 192.168.3.1`. Router A advertises this to another external Router C, keeping the same `NEXT_HOP` since Router C shares the subnet with Router B. |
| **2.3** | **Otherwise, if the external peer to which the route is being advertised shares a common subnet with one of the interfaces of the announcing BGP speaker, the speaker MAY use the IP address associated with such an interface in the NEXT_HOP attribute. This is known as a "first party" NEXT_HOP attribute.**                                                                                               | **2.3. Peer shares a subnet with the announcing router:** <br><br> **Rule**: If the external peer shares a subnet with the announcing router, the router can use its own interface IP as the `NEXT_HOP`. This is a "first-party" NEXT_HOP where the announcing router points to itself. <br><br> **Examples:** <br> **Example 1**: Router A advertises a route to Router C, and both share the subnet `192.168.4.0/24`. Router A uses its own IP (`192.168.4.1`) as the `NEXT_HOP`. <br><br> **Example 2**: Router A advertises a route to external Router C over a shared subnet `10.0.1.0/24`. Router A sets `NEXT_HOP = 10.0.1.1` (its own IP).                                                                                                                                                        |
| **2.4** | **By default (if none of the above conditions apply), the BGP speaker SHOULD use the IP address of the interface that the speaker uses to establish the BGP connection to peer X in the NEXT_HOP attribute.**                                                                                                                                                               | **2.4. Default Behavior:** <br><br> **Rule**: If no other conditions are met, the announcing router uses the IP address of the interface it uses to connect to the external peer as the `NEXT_HOP`. This ensures basic reachability. <br><br> **Examples:** <br> **Example 1**: Router A connects to external Router C using interface `172.30.0.1`. If no specific configuration applies, Router A sets `NEXT_HOP = 172.30.0.1`. <br><br> **Example 2**: If Router A establishes a connection to Router C over interface `10.5.5.1`, it advertises routes with `NEXT_HOP = 10.5.5.1`.                                                                                                                                                                                                                                                                                                          |




---

### **Table 3: External Peer (Multiple Hops Away)**

Here’s the updated table for **External Peer (Multiple Hops Away)** with each rule broken into separate rows and numbered for clarity (e.g., **3.1**, **3.2**):

---

| **No.** | **Original Text**                                                                                                                                                                                                                                                                                  | **Explanation with Enhanced Clarification and Examples**                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |
|---------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **3**   | **When sending a message to an external peer X, and the peer is multiple IP hops away from the speaker (aka "multihop EBGP"):**                                                                                                                                                                                                          | **3. External Peer (Multiple Hops Away):** <br><br> **Scenario**: When the external peer is not directly reachable (e.g., requires multiple routers). <br><br> The following rules apply to determine the `NEXT_HOP`.                                                                                                                                                                                                                                                                                                                                                                                                                                      |
| **3.1** | **The speaker MAY be configured to propagate the NEXT_HOP attribute. In this case, when advertising a route that the speaker learned from one of its peers, the NEXT_HOP attribute of the advertised route is exactly the same as the NEXT_HOP attribute of the learned route (the speaker does not modify the NEXT_HOP attribute).**                                              | **Rule**: Propagate the `NEXT_HOP` unchanged from the route received. <br><br> **Purpose**: This ensures consistency in routing decisions across multiple hops. <br><br> **Examples:** <br> **Example 1**: Router A learns a route from Router B with `NEXT_HOP = 10.1.1.1`. Router A advertises this route unchanged to Router C, maintaining `NEXT_HOP = 10.1.1.1`. Router C knows it must send traffic to `10.1.1.1`. <br><br> **Example 2**: Router A receives a route from Router B with `NEXT_HOP = 192.168.2.1`. Router A forwards this route to external Router C without altering the `NEXT_HOP`, preserving `192.168.2.1`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **3.2** | **By default, the BGP speaker SHOULD use the IP address of the interface that the speaker uses in the NEXT_HOP attribute to establish the BGP connection to peer X.**                                                                                                                                                                  | **Rule**: If no configuration is applied, use the interface IP used to establish the connection to the external peer as the `NEXT_HOP`. <br><br> **Examples:** <br> **Example 1**: Router A connects to Router B via interface `10.2.2.1`. When Router A advertises a route to Router C without specific configuration, it sets `NEXT_HOP = 10.2.2.1`. <br><br> **Example 2**: Router A connects to external Router C through interface `172.16.0.1`. If no special configuration is applied, Router A uses `NEXT_HOP = 172.16.0.1` in its advertisements to ensure proper routing. |





---


| **Original Text**                                                                                                                                         | **Explanation with Enhanced Clarification and Examples**                                                                                                                                                                                                                                                                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| Normally, the NEXT_HOP attribute is chosen such that the shortest available path will be taken. A BGP speaker MUST be able to support the disabling advertisement of third-party NEXT_HOP attributes in order to handle imperfectly bridged media. | **Shortest Path and Third-Party NEXT_HOP**: <br><br> The `NEXT_HOP` is typically selected to ensure the shortest available path for routing traffic. In some cases, third-party `NEXT_HOP` attributes (where a router advertises a next-hop address other than itself) must be disabled to handle situations where the underlying network does not bridge traffic properly. <br><br> **Example**: Router A learns about a route from Router B with `NEXT_HOP = 192.168.1.1`. Router A disables third-party advertisements and replaces the `NEXT_HOP` with its own address if it cannot forward traffic between Router B and other routers. |
| A route originated by a BGP speaker SHALL NOT be advertised to a peer using an address of that peer as NEXT_HOP. A BGP speaker SHALL NOT install a route with itself as the next hop. | **Prohibited NEXT_HOP Configurations**: <br><br> **1. Using Peer’s Address**: A route cannot be advertised back to a peer with the peer’s own address as the `NEXT_HOP`. This prevents misconfigurations or routing loops. <br><br> **2. Self-Referencing Routes**: A router cannot configure itself as the `NEXT_HOP` for its own route. This avoids forwarding errors. <br><br> **Example**: Router A cannot advertise a route to Router B using Router B’s IP (`192.168.2.1`) as the `NEXT_HOP`. Similarly, Router A cannot set its own IP (`172.16.1.1`) as the `NEXT_HOP` for routes it originates. |
| The NEXT_HOP attribute is used by the BGP speaker to determine the actual outbound interface and immediate next-hop address that SHOULD be used to forward transit packets to the associated destinations. | **Role of NEXT_HOP in Packet Forwarding**: <br><br> The `NEXT_HOP` tells a router how to forward traffic by identifying the next router or interface in the path to the destination. <br><br> **Example**: Router A receives a packet destined for `192.168.1.10`. If the `NEXT_HOP` is `172.16.0.1`, Router A checks its routing table to find the interface (e.g., `eth0`) to forward the packet toward `172.16.0.1`. |
| The immediate next-hop address is determined by performing a recursive route lookup operation for the IP address in the NEXT_HOP attribute, using the contents of the Routing Table, selecting one entry if multiple entries of equal cost exist. | **Recursive Route Lookup**: <br><br> The router performs a lookup in its routing table to resolve the `NEXT_HOP` address to an outbound interface. If multiple routes have the same cost, one is selected (usually based on configuration or load balancing). <br><br> **Example**: If Router A receives a packet for `192.168.1.10` with `NEXT_HOP = 172.16.0.1`, it queries the routing table and finds two routes of equal cost (`eth0` and `eth1`). Router A uses its configuration (e.g., round-robin) to choose one interface. |
| The Routing Table entry that resolves the IP address in the NEXT_HOP attribute will always specify the outbound interface. If the entry specifies an attached subnet, but does not specify a next-hop address, then the address in the NEXT_HOP attribute SHOULD be used as the immediate next-hop address. | **Routing Table Resolution**: <br><br> The routing table determines: <br> 1. **Outbound Interface**: The physical or logical interface (e.g., Ethernet0) to use. <br> 2. **Immediate Next-Hop Address**: If the routing table has no next-hop for the destination, the `NEXT_HOP` attribute is used. <br><br> **Example**: Router A receives a packet for `192.168.1.10`. The routing table shows that `172.16.0.1` (the `NEXT_HOP`) is reachable through `eth0`. Router A forwards the packet to `172.16.0.1` via `eth0`. |
| If the entry also specifies the next-hop address, this address SHOULD be used as the immediate next-hop address for packet forwarding. | **Using Next-Hop Address from Routing Table**: <br><br> If the routing table provides a next-hop address, it takes precedence over the `NEXT_HOP` attribute for forwarding. <br><br> **Example**: Router A receives a packet for `192.168.1.10` with `NEXT_HOP = 172.16.0.1`. The routing table resolves `192.168.1.0/24` through `172.16.0.2`. Router A forwards the packet to `172.16.0.2`, overriding the `NEXT_HOP`. |

---




### **Key Principles of NEXT_HOP**
1. **Shortest Path**: The `NEXT_HOP` is typically chosen to ensure the shortest path is taken.
2. **No Self-Reference**:
   - A router cannot use its own IP as the `NEXT_HOP`.
3. **No Peer’s Address**:
   - A route cannot be advertised to a peer using that peer’s own address as the `NEXT_HOP`.

---

### **How is the NEXT_HOP Used?**
1. **Route Lookup**: The `NEXT_HOP` is used to look up the Routing Table.
   - The Routing Table determines:
     - The **outbound interface** (e.g., Ethernet0, Serial1).
     - The **immediate next-hop address** (e.g., `192.168.1.2`).

2. **Example**:
   - Routing Table Entry: 
     - Destination: `10.0.0.0/24`
     - NEXT_HOP: `192.168.1.2`
     - Outbound Interface: `Ethernet0`

   When sending a packet to `10.0.0.5`, the router forwards it to `192.168.1.2` via `Ethernet0`.

---






## 5.6 ATOMIC_AGGREGATE



| **Original Text**                                                                                                                                         | **Explanation with Enhanced Clarification and Examples**                                                                                                                                                                                                                                                                                                                                                     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **ATOMIC_AGGREGATE** <br><br> ATOMIC_AGGREGATE is a well-known discretionary attribute.                                                                                                   | **ATOMIC_AGGREGATE Overview**: <br><br> - `ATOMIC_AGGREGATE` is a **well-known discretionary attribute**, meaning its inclusion in BGP UPDATE messages is optional. <br><br> - It indicates that a route has been **aggregated** (i.e., several routes have been combined into one) for advertisement to a specific peer.                                                                                                                                   |
| When a BGP speaker aggregates several routes for the purpose of advertisement to a particular peer, the AS_PATH of the aggregated route normally includes an AS_SET formed from the set of ASes from which the aggregate was formed. | **AS_PATH and AS_SET in Aggregated Routes**: <br><br> - When multiple routes are aggregated, the `AS_PATH` attribute usually contains an `AS_SET`. <br> - An `AS_SET` is a collection of AS numbers representing the ASes involved in forming the aggregated route. <br><br> **Example**: Router A aggregates two routes: `192.168.1.0/24` from AS1 and `192.168.2.0/24` from AS2. The aggregated route is advertised with an `AS_SET = {AS1, AS2}` in the `AS_PATH`. |
| In many cases, the network administrator can determine if the aggregate can safely be advertised without the AS_SET, and without forming route loops. | **Optional Exclusion of AS_SET**: <br><br> - A network administrator may choose to advertise the aggregated route **without including the AS_SET**. <br> - This is safe only if it does not create **routing loops**. <br><br> **Example**: Router A aggregates two routes from AS1 and AS2. The network administrator determines that the AS numbers can be excluded safely, as the aggregated route won't create loops. The `AS_PATH` in this case omits `AS_SET`. |
| If an aggregate excludes at least some of the AS numbers present in the AS_PATH of the routes that are aggregated as a result of dropping the AS_SET, the aggregated route, when advertised to the peer, SHOULD include the ATOMIC_AGGREGATE attribute. | **Use of ATOMIC_AGGREGATE**: <br><br> - When an aggregated route omits some AS numbers in the `AS_PATH`, the `ATOMIC_AGGREGATE` attribute should be included. <br> - This notifies the peer that the `AS_PATH` might not fully represent the original path of the aggregated routes. <br><br> **Example**: Router A aggregates routes from AS1 and AS2. If `AS_SET` is omitted from the `AS_PATH`, the route is advertised with the `ATOMIC_AGGREGATE` attribute to inform peers about the incomplete `AS_PATH`. |
| A BGP speaker that receives a route with the ATOMIC_AGGREGATE attribute SHOULD NOT remove the attribute when propagating the route to other speakers. | **Propagation of ATOMIC_AGGREGATE**: <br><br> - Routers that receive a route with the `ATOMIC_AGGREGATE` attribute should retain it when advertising the route to other routers. <br><br> **Example**: Router B receives an aggregated route with `ATOMIC_AGGREGATE` from Router A. When Router B advertises this route to Router C, the `ATOMIC_AGGREGATE` attribute remains included. |
| A BGP speaker that receives a route with the ATOMIC_AGGREGATE attribute MUST NOT make any NLRI of that route more specific (as defined in 9.1.4) when advertising this route to other BGP speakers. | **Preventing NLRI Specificity Changes**: <br><br> - Routes with the `ATOMIC_AGGREGATE` attribute must not be advertised with more specific prefixes. This preserves the aggregated nature of the route. <br><br> **Example**: Router A aggregates routes `192.168.1.0/24` and `192.168.2.0/24` into `192.168.0.0/16` with `ATOMIC_AGGREGATE`. Router B receiving this route cannot advertise the more specific `192.168.1.0/24` or `192.168.2.0/24` to other routers. |
| A BGP speaker that receives a route with the ATOMIC_AGGREGATE attribute needs to be aware of the fact that the actual path to destinations, as specified in the NLRI of the route, while having the loop-free property, may not be the path specified in the AS_PATH attribute of the route. | **Implied Path and NLRI Considerations**: <br><br> - The `ATOMIC_AGGREGATE` attribute indicates that the `AS_PATH` may not reflect the actual path to the destination. <br> - However, the advertised route remains **loop-free**. <br><br> **Example**: Router A aggregates routes from AS1 and AS2 into a single route with `ATOMIC_AGGREGATE`. Router B receiving this route must understand that the `AS_PATH` might not represent the exact path to reach the destinations in the NLRI. |

